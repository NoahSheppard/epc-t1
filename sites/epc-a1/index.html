<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panorama with Navigation</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pannellum@2.5.6/build/pannellum.css"/>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/pannellum@2.5.6/build/pannellum.js"></script>
    <style>
    #panorama {
        width: 600px;
        height: 400px;
        position: relative;
    }
    .custom-hotspot {
        width: 30px;
        height: 30px;
        background: rgba(0, 0, 0, 0.5);
        border-radius: 50%;
        cursor: pointer;
        display: flex;
        justify-content: center;
        align-items: center;
    }
    .custom-hotspot::before {
        content: "";
        width: 0;
        height: 0;
        border-top: 10px solid transparent;
        border-bottom: 10px solid transparent;
        border-left: 15px solid white;
    }
    .rectangle-overlay {
        width: 50px;
        height: 30px;
        background-color: rgba(255, 0, 0, 0.5);
        border: 2px solid white;
    }
    
    /* New overlay styles */
    .center-overlay {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 160px;
        height: 80px;
        background-color: rgba(255, 0, 0, 0.7);
        border: 2px solid white;
        border-radius: 50%;
        pointer-events: none; /* Allow clicks to pass through */
        z-index: 100;
        display: flex;
        justify-content: center;
        align-items: center;
        color: white;
        font-weight: bold;
    }
    </style>
</head>
<body>

<div id="panorama-container" style="position: relative;">
    <div id="panorama"></div>
    <div id="center-overlay" class="center-overlay">Overlay Text</div>
</div>

<script>
let savedView = {
  yaw: 0,
  pitch: 0
};

window.viewer = pannellum.viewer('panorama', {
    "default": {
        "firstScene": "bottom-stairwell",
        "sceneFadeDuration": 1000
    },
    "scenes": {
       "bottom-stairwell": {
            "title": "Bottom Stairwell",
            "type": "equirectangular",
            "panorama": "/epc-a1/media/test-r2/bottom-stairwell.jpg",
            "hotSpots": [
                {
                    "pitch": 0,
                    "yaw": 65,
                    "type": "scene", 
                    "text": "Living Room",
                    "clickHandlerFunc": function() {window.loadScene("livingroom-1")}
                },
                {
                    "pitch": 0,
                    "yaw": -15,
                    "type": "scene", 
                    "text": "Foyer",
                    "clickHandlerFunc": function() {window.loadScene("foyer")}
                },
                {
                    "pitch": 0,
                    "yaw": 50,
                    "cssClass": "custom-hotspot",
                    "createTooltipFunc": hotspotMaker
                }
            ]
        },
        "foyer": { 
            "title": "Foyer",
            "type": "equirectangular",
            "panorama": "/epc-a1/media/test-r2/foyer.jpg",
            "hotSpots": [
                {
                    "pitch": 0,
                    "yaw": -120,
                    "type": "scene", 
                    "text": "Bottom Stairwell",
                    "clickHandlerFunc": function() {window.loadScene("bottom-stairwell")}
                }
            ]
        },
        "livingroom-1": {
            "title": "Living Room",
            "type": "equirectangular",
            "panorama": "/epc-a1/media/test-r2/livingroom-1.jpg", 
            "hotSpots": [
                {
                    "pitch": 0,
                    "yaw": 200,
                    "type": "scene",
                    "text": "Bottom Stairwell",
                    "clickHandlerFunc": function() {window.loadScene("bottom-stairwell")}
                },
                {
                    "pitch": 0,
                    "yaw": 15,
                    "type": "scene",
                    "text": "Living Room",
                    "clickHandlerFunc": function() {window.loadScene("livingroom-2")}
                }
            ]
        },
        "livingroom-2": {
            "title": "Living Room",
            "type": "equirectangular",
            "panorama": "/epc-a1/media/test-r2/livingroom-2.jpg", 
            "hotSpots": [
                {
                    "pitch": 0,
                    "yaw": 210,
                    "type": "scene",
                    "text": "Living Room",
                    "clickHandlerFunc": function() {window.loadScene("livingroom-1")}
                }
            ]
        },
    },
});

loadScene = function (id) {
    let currentPitch = window.viewer.getPitch();
    let currentYaw = window.viewer.getYaw();
    let currentHFov = window.viewer.getHfov();
    window.viewer.loadScene(id, currentPitch, currentYaw, currentHFov, 0, function() {console.log("Switched!");});                   
}

function hotspotMaker(hotSpotDiv) {
    // Create a rectangle
    hotSpotDiv.classList.add('rectangle-overlay');
    // Or add text
    hotSpotDiv.innerText = "Your text here";
}

// Position the overlay to be centered on the panorama
function positionOverlay() {
    const panoramaElement = document.getElementById('panorama');
    const overlayElement = document.getElementById('center-overlay');
    
    if (panoramaElement && overlayElement) {
        const panoramaRect = panoramaElement.getBoundingClientRect();
        
        // Set the container to match the panorama dimensions
        const container = document.getElementById('panorama-container');
        container.style.width = panoramaRect.width + 'px';
        container.style.height = panoramaRect.height + 'px';
    }
}

// Call this when the viewer is loaded
window.viewer.on('load', function() {
    positionOverlay();
});

// Make sure overlay stays positioned correctly if window is resized
window.addEventListener('resize', positionOverlay);

// Initial positioning
document.addEventListener('DOMContentLoaded', function() {
    setTimeout(positionOverlay, 100); // Small delay to ensure Pannellum is initialized
});
</script>

</body>
</html>